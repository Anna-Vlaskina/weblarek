https://anna-vlaskina.github.io/weblarek/

# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/main.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
# Интернет-магазин «Web-Larёk»
«Web-Larёk» — это интернет-магазин с товарами для веб-разработчиков, где пользователи могут просматривать товары, добавлять их в корзину и оформлять заказы. Сайт предоставляет удобный интерфейс с модальными окнами для просмотра деталей товаров, управления корзиной и выбора способа оплаты, обеспечивая полный цикл покупки с отправкой заказов на сервер.

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP (Model-View-Presenter), которая обеспечивает четкое разделение ответственности между классами слоев Model и View. Каждый слой несет свой смысл и ответственность:

Model - слой данных, отвечает за хранение и изменение данных.  
View - слой представления, отвечает за отображение данных на странице.  
Presenter - презентер содержит основную логику приложения и  отвечает за связь представления и данных.

Взаимодействие между классами обеспечивается использованием событийно-ориентированного подхода. Модели и Представления генерируют события при изменении данных или взаимодействии пользователя с приложением, а Презентер обрабатывает эти события используя методы как Моделей, так и Представлений.

### Базовый код

#### Класс Component
Является базовым классом для всех компонентов интерфейса.
Класс является дженериком и принимает в переменной `T` тип данных, которые могут быть переданы в метод `render` для отображения.

Конструктор:  
`constructor(container: HTMLElement)` - принимает ссылку на DOM элемент за отображение, которого он отвечает.

Поля класса:  
`container: HTMLElement` - поле для хранения корневого DOM элемента компонента.

Методы класса:  
`render(data?: Partial<T>): HTMLElement` - Главный метод класса. Он принимает данные, которые необходимо отобразить в интерфейсе, записывает эти данные в поля класса и возвращает ссылку на DOM-элемент. Предполагается, что в классах, которые будут наследоваться от `Component` будут реализованы сеттеры для полей с данными, которые будут вызываться в момент вызова `render` и записывать данные в необходимые DOM элементы.  
`setImage(element: HTMLImageElement, src: string, alt?: string): void` - утилитарный метод для модификации DOM-элементов `<img>`

#### Класс Api
Содержит в себе базовую логику отправки запросов.

Конструктор:  
`constructor(baseUrl: string, options: RequestInit = {})` - В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Поля класса:  
`baseUrl: string` - базовый адрес сервера  
`options: RequestInit` - объект с заголовками, которые будут использованы для запросов.

Методы:  
`get(uri: string): Promise<object>` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер  
`post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.  
`handleResponse(response: Response): Promise<object>` - защищенный метод проверяющий ответ сервера на корректность и возвращающий объект с данными полученный от сервера или отклоненный промис, в случае некорректных данных.

#### Класс EventEmitter
Брокер событий реализует паттерн "Наблюдатель", позволяющий отправлять события и подписываться на события, происходящие в системе. Класс используется для связи слоя данных и представления.

Конструктор класса не принимает параметров.

Поля класса:  
`_events: Map<string | RegExp, Set<Function>>)` -  хранит коллекцию подписок на события. Ключи коллекции - названия событий или регулярное выражение, значения - коллекция функций обработчиков, которые будут вызваны при срабатывании события.

Методы класса:  
`on<T extends object>(event: EventName, callback: (data: T) => void): void` - подписка на событие, принимает название события и функцию обработчик.  
`emit<T extends object>(event: string, data?: T): void` - инициализация события. При вызове события в метод передается название события и объект с данными, который будет использован как аргумент для вызова обработчика.  
`trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие с передачей в него данных из второго параметра.

### Данные
В приложении используются две сущности, которые описывают данные, — товар и покупатель. Их можно описать интерфейсами IProduct и IBuyer.

#### Интерфейс IProduct
Включает данные, котрые описывают сущность "Товар".

Свойства интерфейса:
`id: string` - уникальный идентификатор товара.
`description: string` - описание товара.
`image: string` - ссылка на изображение товара.
`title: string` - название товара.
`category: string` - категория товара.
`price: number | null` - цена товара.

#### Интерфейс IBuyer
Включает данные, которые описывают сущность "Покупатель".

Свойства интерфейса:
`payment: 'card' | 'cash' | ''` - способ оплаты.
`email: string` - электронная почта.
`phone: string` - телефон.
`address: string` - адресс.

### Модели данных
Для учёта данных в приложении реализуются классы, разделеные по смыслу и зонам ответственности: ProductCatalog, Basket, Buyer.

#### Класс ProductCatalog
Хранение и управление каталогом товаров. Отвечает за работу с перечнем товаров и отображением отдельных товаров для просмотра.

Конструктор класса:
`constructor(initialProducts: IProduct[], events: IEvents)` - в конструктор передается начальный массив товаров и обработчик событий.

Поля класса:
`arrayProducts: IProduct[]` - хранит массив всех товаров в каталоге.
`cardProduct: IProduct` - товар, который в данный момент отображается для просмотра.
`protected events: IEvents` - обработчик событий для уведомления об изменениях в каталоге.

Методы класса:
`setArrayProducts(arrayProducts: IProduct[]): void` - полная замена массива товаров в каталоге и генерация события изменения.
`getArrayProducts(): IProduct[]` - получение копии массива всех товаров в каталоге.
`getProduct(id: string): IProduct` - получение товара по ID из каталога.
`setProductForDisplay(cardProduct: IProduct): void` - установка товара для отображения на детальной странице и генерация события изменения отображения.
`getProductForDisplay(): IProduct` - получение товара, который в данный момент отображается для просмотра.

#### Класс Basket
Хранение товаров, которые пользователь выбрал для покупки. Управляет состоянием корзины и уведомляет о изменениях через систему событий.

Конструктор класса:
`constructor(selectedProducts: IProduct[] = [], events: IEvents)` - в конструктор передается массив товаров, добавленных пользователем в корзину, и обработчик событий.

Поля класса:
`arrayProducts: IProduct[]` - хранит массив товаров, выбранных покупателем для покупки.
`protected events: IEvents` - обработчик событий для уведомления об изменениях в корзине.

Методы класса:
`getArrayBasket(): IProduct[]` - получение копии массива товаров, которые находятся в корзине.
`addProduct(product: IProduct): IProduct[]` - добавление товара в корзину и генерация события добавления.
`delProduct(id: string): IProduct[]` - удаление товара по ID из корзины и генерация события удаления.
`clearBasket(): void` - полная очистка корзины и генерация события очистки.
`getTotalPrice(): number | null` - вычисление общей стоимости всех товаров в корзине.
`getItemsCount(): number` - получение количества товаров в корзине.
`hasProduct(id: string): boolean` - проверка наличия товара в корзине по его ID.

#### Класс Buyer
Хранение данных покупателя, которые используются для оформления заказа. Управляет состоянием данных покупателя и уведомляет о изменениях через систему событий.

Конструктор класса:
`constructor(buyerData: IBuyer, events: IEvents)` - в конструктор передаются начальные данные покупателя и обработчик событий.

Поля класса:
`payment: 'card' | 'cash' | ''` - способ оплаты заказа.
`email: string` - электронная почта покупателя.
`phone: string` - телефон покупателя.
`address: string` - адрес доставки заказа.
`protected events: IEvents` - обработчик событий для уведомления об изменениях данных.

Методы класса:
`saveOrderData(buyerData: IBuyer): void` - сохранение новых данных покупателя и генерация события сохранения.
`getBuyerData(): IBuyer `- получение всех данных покупателя в виде объекта.
`clearBuyerData(): void` - очистка всех данных покупателя и генерация события очистки.
`validateOrder(): boolean` - проверка валидности данных для оформления заказа (наличие оплаты и адреса).
`validateContacts(): boolean` - проверка валидности контактных данных (email и телефон).
`private getChangedFields(oldData: IBuyer, newData: IBuyer): string[]` - получение списка измененных полей между двумя состояниями данных.

### Слой коммуникации

#### Класс ApiComposition
Отвечает за получение данных с сервера и отправку данных на сервер. С помощью композиции он использует функционал методов класса Api.

Конструктор класса:
`constructor(instanceApi: IApi)` - в конструктор передается экземпляр класса, соответсвующий интерфейсу IApi.

Поля класса:
`instanceApi: IApi` - экземпляр класса, соответсвующий интерфейсу IApi.

Методы класса:
`get<T extends object>(uri: string): Promise<T>` - метод класса Api, который выполняет GET запрос на сервер и получает объект с массивом товаров.
`post<T extends object>(uri: string, data: object, method?: ApiPostMethods): Promise<T>` - метод класса Api, который принимает объект с данными о покупателе и выбранных товарах и отправляет их на сервер.

### Слой представления

#### Класс BasketView
Представление корзины товаров. Отвечает за отображение списка товаров в корзине и общей стоимости.

Конструктор класса:
`constructor(container: HTMLElement, events: EventEmitter)` - в конструктор передается контейнер для размещения корзины и обработчик событий.

Поля класса:
`protected titleElement: HTMLElement` - элемент заголовка модального окна корзины.
`productsElement: HTMLElement` - контейнер для списка товаров в корзине.
`basketButton: HTMLButtonElement - кнопка оформления заказа.
`protected priceElement: HTMLElement` - элемент отображения общей стоимости товаров.
`protected events: EventEmitter` - обработчик событий для коммуникации с другими компонентами.

Методы класса:
`set products(items: HTMLElement[])` - установка списка товаров в корзине (очищает текущий список и добавляет новые элементы).
`set price(value: string)` - установка общей стоимости товаров в корзине.

#### Класс Card
Абстрактный базовый класс карточки товара. Определяет общую структуру и поведение для всех типов карточек товаров.

Конструктор класса:
`constructor(container: HTMLElement)` - в конструктор передается контейнер DOM-элемента карточки товара.

Поля класса:
`protected titleElement: HTMLElement` - элемент для отображения названия товара.
`protected priceElement: HTMLElement` - элемент для отображения цены товара.

Методы класса:
`set title(value: string)` - установка названия товара в соответствующий DOM-элемент.
`set price(value: number | null)` - установка цены товара. Если передано null, отображает "Бесценно".

#### Класс CardBasket
Карточка товара в корзине. Расширяет базовую карточку товара, добавляя функциональность для отображения в корзине.

Конструктор класса:
`constructor(container: HTMLElement, actions?: ICardActions)` - в конструктор передается контейнер карточки и опциональные действия для обработки событий.

Поля класса:
`protected indexElement: HTMLElement` - элемент для отображения порядкового номера товара в корзине.
`protected buttonElement: HTMLButtonElement` - кнопка удаления товара из корзины.

Методы класса:
`set index(value: number)` - установка порядкового номера товара в корзине.

#### Класс CardCatalog
Карточка товара в каталоге. Расширяет базовую карточку товара, добавляя функциональность для отображения в каталоге товаров.

Конструктор класса:
`constructor(container: HTMLElement, actions?: ICardActions)` - в конструктор передается контейнер карточки и опциональные действия для обработки событий.

Поля класса:
`protected categoryElement: HTMLElement` - элемент для отображения категории товара.
`protected imageElement: HTMLImageElement` - элемент для отображения изображения товара.

Методы класса:
`set category(value: string)` - установка категории товара с применением соответствующих CSS-классов для стилизации.
`set image(value: string)` - установка изображения товара с формированием полного URL и альтернативным текстом.

#### Класс CardPreview
Карточка предпросмотра товара. Расширяет базовую карточку товара, добавляя функциональность для детального отображения товара на странице предпросмотра.

Конструктор класса:
`constructor(container: HTMLElement, actions?: ICardActions)` - в конструктор передается контейнер карточки и опциональные действия для обработки событий.

Поля класса:
`protected imageElement: HTMLImageElement` - элемент для отображения изображения товара.
`protected categoryElement: HTMLElement` - элемент для отображения категории товара.
`protected descriptionElement: HTMLParagraphElement` - элемент для отображения описания товара.
`protected buttonElement: HTMLButtonElement` - кнопка добавления товара в корзину.

Методы класса:
`set category(value: string)` - установка категории товара с применением соответствующих CSS-классов для стилизации.
`set image(value: string)` - установка изображения товара с формированием полного URL и альтернативным текстом.
`set description(value: string)` - установка описания товара.

#### Класс Form
Абстрактный базовый класс формы. Определяет общую структуру и поведение для всех типов форм в приложении.

Конструктор класса:
`constructor(container: HTMLElement, events: IEvents)` - в конструктор передается контейнер формы и обработчик событий.

Поля класса:
`protected submitElement: HTMLButtonElement` - кнопка отправки формы.
`protected errorsElement: HTMLElement` - элемент для отображения ошибок валидации.
`protected events: IEvents` - обработчик событий для коммуникации с другими компонентами.

Методы класса:
`set errors(value: string)` - установка текста ошибок валидации формы.
`set valid(isValid: boolean)` - управление состоянием кнопки отправки формы (активна/неактивна) в зависимости от валидности данных.

#### Класс FormContacts
Форма контактных данных покупателя. Расширяет базовую форму, добавляя функциональность для ввода и валидации контактной информации.

Конструктор класса:
`constructor(container: HTMLElement, events: IEvents)` - в конструктор передается контейнер формы и обработчик событий.

Поля класса:
`protected titleLabelElement: HTMLSpanElement[]` - массив элементов заголовков полей формы.
`protected inputElements: HTMLInputElement[]` - массив элементов ввода данных формы.
`protected events: IEvents` - обработчик событий для коммуникации с другими компонентами.

Методы класса:
`set email(value: string)` - установка значения email в соответствующее поле ввода.
`set phone(value: string)` - установка значения телефона в соответствующее поле ввода.

#### Класс FormOrder
Форма оформления заказа. Расширяет базовую форму, добавляя функциональность для выбора способа оплаты и ввода адреса доставки.

Конструктор класса:
`constructor(container: HTMLElement, events: IEvents)` - в конструктор передается контейнер формы и обработчик событий.

Поля класса:
`protected titleForm: HTMLHeadingElement` - заголовок формы оформления заказа.
`protected buttonsForm: HTMLButtonElement[]` - массив кнопок выбора способа оплаты.
`protected titleLabelElement: HTMLSpanElement` - элемент заголовка поля ввода адреса.
`protected inputElement: HTMLInputElement` - поле ввода адреса доставки.
`protected events: IEvents` - обработчик событий для коммуникации с другими компонентами.

Методы класса:
`set payment(value: 'card' | 'cash' | '')` - установка активного способа оплаты с визуальным выделением выбранной кнопки.
`set address(value: string)` - установка значения адреса доставки в поле ввода.

#### Класс Gallery
Компонент галереи товаров. Отвечает за отображение каталога товаров в виде галереи.

Конструктор класса:
`constructor(container: HTMLElement, events?: IEvents)` - в конструктор передается контейнер для размещения галереи и опциональный обработчик событий.

Поля класса:
`protected catalogElement: HTMLElement` - контейнер для отображения элементов каталога товаров.
`protected events?: IEvents` - опциональный обработчик событий для коммуникации с другими компонентами.

Методы класса:
`set catalog(items: HTMLElement[])` - установка элементов каталога в галерею (очищает текущий список и добавляет новые элементы).

#### Класс Header
Компонент шапки приложения. Отвечает за отображение счетчика товаров в корзине и обработку открытия корзины.

Конструктор класса:
`constructor(events: IEvents, container: HTMLElement)` - в конструктор передается обработчик событий и контейнер для размещения шапки.

Поля класса:
`protected basketButton: HTMLButtonElement` - кнопка корзины для открытия интерфейса корзины.
`protected counterElement: HTMLElement` - элемент для отображения счетчика товаров в корзине.
`protected events: IEvents` - обработчик событий для коммуникации с другими компонентами.

Методы класса:
`set counter(value: number)` - установка значения счетчика товаров в корзине.

#### Класс Modal
Компонент модального окна. Отвечает за отображение контента в модальном окне и обработку его закрытия.

Конструктор класса:
`constructor(container: HTMLElement, events?: IEvents)` - в конструктор передается контейнер модального окна и опциональный обработчик событий.

Поля класса:
`protected modalButton: HTMLButtonElement` - кнопка закрытия модального окна.
`protected contentElement: HTMLElement` - контейнер для отображения содержимого модального окна.
`protected events?: IEvents` - опциональный обработчик событий для коммуникации с другими компонентами.

Методы класса:
`set content(element: HTMLElement)` - установка содержимого модального окна (очищает текущий контент и добавляет новый элемент).

#### Класс OrderSuccess
Компонент успешного оформления заказа. Отображает информацию о завершенном заказе и предоставляет возможность закрытия уведомления.

Конструктор класса:
`constructor(container: HTMLElement, events: IEvents)` - в конструктор передается контейнер компонента и обработчик событий.

Поля класса:
`protected titleElement: HTMLElement` - элемент заголовка уведомления об успешном заказе.
`protected priceElement: HTMLElement` - элемент отображения стоимости заказа.
`protected successButton: HTMLButtonElement` - кнопка закрытия уведомления об успешном заказе.
`protected events: IEvents` - обработчик событий для коммуникации с другими компонентами.

Методы класса:
`set price(value: string)` - установка текста с информацией о стоимости завершенного заказа.

### События в классах

`basket:initialized` - Событие инициализации корзины. Уведомляет подписчиков о том, что корзина полностью готова к работе.

`basket:product:added` - Событие добавления товара в корзину. Уведомляет о успешном добавлении товара и предоставляет актуальное состояние корзины.

`basket:product:removed` - Событие удаления товара из корзины. Уведомляет об удалении товара и предоставляет актуальное состояние корзины.

`basket:cleared` - Событие полной очистки корзины. Уведомляет о полном удалении всех товаров из корзины.

`buyer:initialized` - Событие инициализации данных покупателя. Уведомляет о том, что данные покупателя полностью загружены и готовы к использованию.

`buyer:data:saved` - Событие сохранения данных покупателя. Уведомляет об успешном сохранении новых данных покупателя и предоставляет информацию об изменениях.

`buyer:data:cleared` - Событие очистки данных покупателя. Уведомляет о полной очистке всех данных покупателя и сбросе к начальному состоянию.

`buyer:validation:checked:contacts` - Событие проверки валидации контактных данных покупателя. Уведомляет о результатах проверки корректности контактной информации покупателя.

`products:changed` - Событие изменения списка товаров. Уведомляет об изменении перечня товаров, доступных для добавления в корзину.

`product:display:changed` - Событие изменения отображаемого товара. Уведомляет об изменении товара, который в данный момент просматривается на детальной странице.

`order:open` - Событие открытия формы заказа. Уведомляет о том, что пользователь инициировал открытие формы оформления заказа.

`button:click` - Событие клика по кнопке. Уведомляет о нажатии пользователем на интерактивный элемент кнопки.

`container:click` - Событие клика по контейнеру. Уведомляет о нажатии пользователем на область контейнера элемента.

`button:click` - Событие клика по кнопке. Уведомляет о нажатии пользователем на интерактивный элемент кнопки.

`{formName}:form:submit` - Событие отправки формы. Уведомляет о том, что пользователь отправил данные формы для обработки.

`contacts:input:change` - Событие изменения ввода контактных данных. Уведомляет об изменении значений в полях ввода контактной информации.

`order:payment:change` - Событие изменения способа оплаты заказа. Уведомляет о выборе пользователем нового способа оплаты для оформляемого заказа.

`order:address:change` - Событие изменения адреса доставки заказа. Уведомляет об изменении введенного пользователем адреса доставки для оформляемого заказа.

`basket:open` - Событие открытия корзины. Уведомляет о том, что пользователь инициировал открытие интерфейса корзины товаров.

`modal:close` - Событие закрытия модального окна. Уведомляет о том, что пользователь инициировал закрытие активного модального окна.

`success:close` - Событие закрытия окна успешного выполнения. Уведомляет о том, что пользователь закрыл окно с сообщением об успешном завершении операции.

### Слой презентера
Код презентера реализован в основном скрипте приложения main.ts. Презентер реализует паттерн Наблюдатель через систему событий, обеспечивая слабую связность между компонентами и централизованное управление бизнес-логикой приложения.

#### Инициализация компонентов

Модели данных:
`basketModel: Basket` - управление состоянием корзины товаров

`buyerModel: Buyer` - управление данными покупателя

`productCatalog: ProductCatalog` - управление каталогом товаров

Представления:
`gallery: Gallery` - отображение каталога товаров

`modal: Modal` - управление модальными окнами

`basketView: BasketView` - отображение корзины товаров

`header: Header` - шапка приложения со счетчиком корзины

`orderForm: FormOrder` - форма оформления заказа

`contactsForm: FormContacts` - форма контактных данных

`successView: OrderSuccess` - уведомление об успешном заказе

Сервисы:
`api: ApiComposition` - взаимодействие с backend API

#### Ключевые методы управления состоянием

`updateUI()`
Обновление пользовательского интерфейса при изменениях состояния приложения.

`updateBasketCounter()`
Обновление счетчика товаров в корзине в шапке приложения.

`updateBasketView()`
Обновление отображения содержимого корзины с учетом текущего состояния.

`updatePreviewButton(item: IProduct, button: HTMLButtonElement)`
Обновление состояния кнопки в карточке товара (доступность, текст).

`validateOrderForm(): boolean`
Валидация данных формы заказа (способ оплаты и адрес доставки).

`validateContactsForm(): boolean`
Валидация контактных данных покупателя (email и телефон).

`submitOrder(): Promise<void>`
Отправка данных заказа на сервер и обработка результата.

#### Поток данных приложения

Инициализация → Загрузка каталога товаров → Отображение галереи

Просмотр товара → Клик по карточке → Открытие модального окна с деталями

Работа с корзиной → Добавление/удаление товаров → Обновление UI в реальном времени

Оформление заказа → Заполнение данных → Валидация → Отправка на сервер

Завершение → Отображение результата → Очистка состояния